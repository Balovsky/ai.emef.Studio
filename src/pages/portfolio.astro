<!-- ---
// Plik: src/pages/portfolio.astro
import MainLayout from '../layouts/MainLayout.astro';
---

<MainLayout title="Portfolio | Studio.AI">
    
    <div class="pt-32 pb-12 bg-white text-center px-4">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-6" data-aos="fade-up">
            Nasze Realizacje
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="100">
            Przeglądaj wybrane projekty. Kliknij zdjęcie, aby zobaczyć detale.
        </p>

        <div class="flex flex-wrap justify-center gap-3 mt-8" data-aos="fade-up" data-aos-delay="200" id="portfolio-filters">
            <button class="filter-btn active px-5 py-2 bg-black text-white rounded-full text-sm font-bold transition-all" data-filter="all">Wszystkie</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="packshot">Packshoty</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="fashion">Fashion</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="ai">AI Creative</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 pb-24">
        <div class="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4" id="portfolio-grid">
            
            <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop" 
                     alt="Zegarek Premium" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

            <div class="portfolio-item item-fashion break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=1600&auto=format&fit=crop"
                     alt="Fashion Model" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

            <div class="portfolio-item item-ai break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=1600&auto=format&fit=crop"
                     alt="AI Background" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

            <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1549298916-b41d501d3772?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1549298916-b41d501d3772?q=80&w=1600&auto=format&fit=crop"
                     alt="Obuwie" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

             <div class="portfolio-item item-ai break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1629198688000-71f23e745b6e?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1629198688000-71f23e745b6e?q=80&w=1600&auto=format&fit=crop"
                     alt="Kosmetyki" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

             <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1600&auto=format&fit=crop"
                     alt="Elektronika" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
            </div>

        </div>
    </div>

    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/95 hidden flex flex-col justify-center items-center opacity-0 transition-opacity duration-300">
        
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-center text-white z-20">
            <div id="lightbox-counter" class="text-sm font-mono opacity-70 ml-2">1 / 10</div>
            <button id="lightbox-close" class="text-4xl hover:text-gray-300 focus:outline-none leading-none">&times;</button>
        </div>

        <button id="btn-prev" class="absolute left-2 md:left-8 top-1/2 -translate-y-1/2 z-20 p-3 rounded-full bg-white/10 hover:bg-white/20 text-white transition backdrop-blur-sm">
            <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>

        <img id="lightbox-img" src="" alt="Pełny ekran" class="max-h-[70vh] md:max-h-[80vh] max-w-[95vw] object-contain rounded-sm shadow-2xl transition-transform duration-300" />
        
        <button id="btn-next" class="absolute right-2 md:right-8 top-1/2 -translate-y-1/2 z-20 p-3 rounded-full bg-white/10 hover:bg-white/20 text-white transition backdrop-blur-sm">
            <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>

        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/80 to-transparent pt-8 pb-4 px-4 z-20 flex flex-col items-center">
            
            <p id="lightbox-caption" class="text-white text-sm md:text-lg font-bold mb-4 tracking-wide"></p>
            
            <div class="flex gap-2 overflow-x-auto max-w-full pb-2 scrollbar-hide snap-x" id="thumbnails-container">
                </div>
        </div>

    </div>

</MainLayout>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .thumbnail {
        opacity: 0.5;
        transition: all 0.3s;
        border: 2px solid transparent;
    }
    .thumbnail.active {
        opacity: 1;
        border-color: white;
        transform: scale(1.1);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // ELEMENTY DOM
        const filterBtns = document.querySelectorAll('.filter-btn');
        const allPortfolioItems = document.querySelectorAll('.portfolio-item');
        
        const lightbox = document.getElementById('lightbox');
        const mainImg = document.getElementById('lightbox-img');
        const caption = document.getElementById('lightbox-caption');
        const counter = document.getElementById('lightbox-counter');
        const thumbnailsContainer = document.getElementById('thumbnails-container');
        
        // ZMIENNE STANU
        // 'allImages' to baza wszystkich zdjęć na stronie (stała)
        const allImages = Array.from(document.querySelectorAll('.gallery-img'));
        
        // 'currentImages' to lista AKTUALNIE widocznych zdjęć (zmienna)
        // Na start są to wszystkie zdjęcia
        let currentImages = [...allImages]; 
        let currentIndex = 0;

        // --- 1. FUNKCJA FILTROWANIA ---
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // UI Przycisków
                filterBtns.forEach(b => {
                    b.classList.remove('bg-black', 'text-white');
                    b.classList.add('bg-white', 'text-gray-500', 'border-gray-200');
                });
                btn.classList.remove('bg-white', 'text-gray-500', 'border-gray-200');
                btn.classList.add('bg-black', 'text-white');

                const filterValue = btn.getAttribute('data-filter');
                
                // Resetujemy listę aktualnych zdjęć
                currentImages = [];

                allPortfolioItems.forEach(item => {
                    const img = item.querySelector('img');
                    
                    // Sprawdzamy czy element pasuje do filtra
                    if (filterValue === 'all' || item.classList.contains(`item-${filterValue}`)) {
                        item.classList.remove('hidden');
                        item.classList.add('block');
                        // Dodajemy zdjęcie do nowej listy playlisty Lightboxa
                        if(img) currentImages.push(img);
                    } else {
                        item.classList.add('hidden');
                        item.classList.remove('block');
                    }
                });

                // Ważne: Po zmianie filtra musimy przebudować miniatury w Lightboxie
                // (Zrobimy to dynamicznie dopiero przy otwarciu Lightboxa, żeby nie mulić strony)
            });
        });


        // --- 2. FUNKCJE LIGHTBOXA ---

        const updateLightboxContent = () => {
            const currentImgElement = currentImages[currentIndex];
            const fullSrc = currentImgElement.getAttribute('data-full') || currentImgElement.src;
            
            // Podmień główne zdjęcie
            mainImg.src = fullSrc;
            if(caption) caption.innerText = currentImgElement.alt;
            if(counter) counter.innerText = `${currentIndex + 1} / ${currentImages.length}`;

            // Aktualizuj styl miniatur
            highlightThumbnail();
        };

        const renderThumbnails = () => {
            if(!thumbnailsContainer) return;
            thumbnailsContainer.innerHTML = ''; // Wyczyść stare miniatury

            currentImages.forEach((img, index) => {
                const thumb = document.createElement('img');
                thumb.src = img.src; 
                thumb.className = `thumbnail h-12 w-12 md:h-16 md:w-16 object-cover rounded cursor-pointer shrink-0 snap-center border-2 border-transparent transition-all opacity-50`;
                
                // Kliknięcie w miniaturę
                thumb.addEventListener('click', (e) => {
                    e.stopPropagation();
                    currentIndex = index;
                    updateLightboxContent();
                });
                
                thumbnailsContainer.appendChild(thumb);
            });
        };

        const highlightThumbnail = () => {
            if(!thumbnailsContainer) return;
            const thumbs = Array.from(thumbnailsContainer.children);
            
            thumbs.forEach((t, i) => {
                if (i === currentIndex) {
                    t.classList.remove('opacity-50', 'border-transparent');
                    t.classList.add('opacity-100', 'border-white', 'scale-110');
                    t.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                } else {
                    t.classList.add('opacity-50', 'border-transparent');
                    t.classList.remove('opacity-100', 'border-white', 'scale-110');
                }
            });
        };

        const openLightbox = (imgElement) => {
            // Znajdź indeks klikniętego zdjęcia w AKTUALNEJ (przefiltrowanej) liście
            const index = currentImages.indexOf(imgElement);
            
            if (index > -1) {
                currentIndex = index;
                
                // Przebuduj miniatury (bo lista mogła się zmienić przez filtr)
                renderThumbnails();
                updateLightboxContent();
                
                lightbox.classList.remove('hidden');
                setTimeout(() => lightbox.classList.remove('opacity-0'), 10);
                // document.body.style.overflow = 'hidden';
            }
        };

        const closeLightbox = () => {
            lightbox.classList.add('opacity-0');
            setTimeout(() => {
                lightbox.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        };

        // --- 3. EVENT LISTENERS ---

        // Kliknięcie w zdjęcie w siatce
        // Musimy nasłuchiwać na rodzicu lub dodać do wszystkich, ale allImages mamy w pamięci
        allImages.forEach(img => {
            img.parentElement.addEventListener('click', (e) => {
                // Upewnij się, że klikamy w zdjęcie, które jest w aktualnej liście (widoczne)
                if (currentImages.includes(img)) {
                    openLightbox(img);
                }
            });
        });

        // Nawigacja
        const showNext = (e) => { e?.stopPropagation(); currentIndex = (currentIndex + 1) % currentImages.length; updateLightboxContent(); };
        const showPrev = (e) => { e?.stopPropagation(); currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; updateLightboxContent(); };

        document.getElementById('btn-next')?.addEventListener('click', showNext);
        document.getElementById('btn-prev')?.addEventListener('click', showPrev);
        document.getElementById('lightbox-close')?.addEventListener('click', closeLightbox);

        lightbox?.addEventListener('click', (e) => {
            if (e.target === lightbox || e.target === document.querySelector('#lightbox > div')) closeLightbox();
        });

        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('hidden')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowRight') showNext();
            if (e.key === 'ArrowLeft') showPrev();
        });

    });
</script> -->


---
// Plik: src/pages/portfolio.astro
import MainLayout from '../layouts/MainLayout.astro';
---

<MainLayout title="Portfolio | Studio.AI">
    
    <div class="pt-32 pb-12 bg-white text-center px-4">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-6" data-aos="fade-up">
            Nasze Realizacje
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="100">
            Przeglądaj wybrane projekty. Kliknij zdjęcie, aby zobaczyć detale.
        </p>

        <div class="flex flex-wrap justify-center gap-3 mt-8" data-aos="fade-up" data-aos-delay="200" id="portfolio-filters">
            <button class="filter-btn active px-5 py-2 bg-black text-white rounded-full text-sm font-bold transition-all" data-filter="all">Wszystkie</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="packshot">Packshoty</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="fashion">Fashion</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="ai">AI Creative</button>
            <button class="filter-btn px-5 py-2 border border-gray-200 text-gray-500 rounded-full text-sm font-bold hover:border-black hover:text-black transition-all" data-filter="graphic">Grafika & DTP</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 pb-24">
        
        <div class="columns-1 md:columns-2 lg:columns-3 gap-4 space-y-4" id="portfolio-grid">
            
            <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop" 
                     alt="Zegarek Premium" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Zegarek</span>
                </div>
            </div>

            <div class="portfolio-item item-graphic break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1596464716127-f2a82984de30?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1596464716127-f2a82984de30?q=80&w=1600&auto=format&fit=crop"
                     alt="Branding & Wizytówki" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Wizytówki</span>
                </div>
            </div>

            <div class="portfolio-item item-fashion break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?q=80&w=1600&auto=format&fit=crop"
                     alt="Fashion Model" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Fashion</span>
                </div>
            </div>

            <div class="portfolio-item item-graphic break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1586075010923-2dd4570fb338?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1586075010923-2dd4570fb338?q=80&w=1600&auto=format&fit=crop"
                     alt="Kalendarz & Plakat" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Kalendarze</span>
                </div>
            </div>

            <div class="portfolio-item item-ai break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1618331835717-801e976710b2?q=80&w=1600&auto=format&fit=crop"
                     alt="AI Background" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">AI Sceneria</span>
                </div>
            </div>

            <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1549298916-b41d501d3772?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1549298916-b41d501d3772?q=80&w=1600&auto=format&fit=crop"
                     alt="Obuwie" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                 <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Obuwie</span>
                </div>
            </div>

            <div class="portfolio-item item-graphic break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1626785774625-ddcddc3445e9?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1626785774625-ddcddc3445e9?q=80&w=1600&auto=format&fit=crop"
                     alt="Projekt Ulotki" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                 <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Ulotki</span>
                </div>
            </div>

             <div class="portfolio-item item-ai break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1629198688000-71f23e745b6e?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1629198688000-71f23e745b6e?q=80&w=1600&auto=format&fit=crop"
                     alt="Kosmetyki" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                 <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Kosmetyki AI</span>
                </div>
            </div>

            <div class="portfolio-item item-packshot break-inside-avoid relative group rounded-xl overflow-hidden cursor-zoom-in" data-aos="fade-up">
                <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=800&auto=format&fit=crop" 
                     data-full="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=1600&auto=format&fit=crop"
                     alt="Elektronika" 
                     class="gallery-img w-full h-auto object-cover transition duration-700 group-hover:scale-105"/>
                 <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center pointer-events-none">
                    <span class="text-white font-bold border border-white px-4 py-2 rounded-full text-sm">Elektronika</span>
                </div>
            </div>

        </div>

        <div class="text-center mt-20 bg-slate-50 p-12 rounded-3xl">
            <h2 class="text-2xl font-bold mb-4">Podobają Ci się te realizacje?</h2>
            <p class="text-gray-600 mb-8">Możemy stworzyć takie same dla Twojej marki w 7 dni.</p>
            <a href="/kontakt" class="inline-block px-8 py-4 bg-black text-white font-bold rounded-full hover:bg-gray-800 transition shadow-lg transform hover:-translate-y-1">
                Zamów darmową próbkę
            </a>
        </div>
    </div>

    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/95 hidden flex flex-col justify-center items-center opacity-0 transition-opacity duration-300">
        
        <div class="absolute top-0 left-0 w-full p-4 flex justify-between items-center text-white z-20">
            <div id="lightbox-counter" class="text-sm font-mono opacity-70 ml-2">1 / 10</div>
            <button id="lightbox-close" class="text-4xl hover:text-gray-300 focus:outline-none leading-none">&times;</button>
        </div>

        <button id="btn-prev" class="absolute left-2 md:left-8 top-1/2 -translate-y-1/2 z-20 p-3 rounded-full bg-white/10 hover:bg-white/20 text-white transition backdrop-blur-sm">
            <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>

        <img id="lightbox-img" src="" alt="Pełny ekran" class="max-h-[70vh] md:max-h-[80vh] max-w-[95vw] object-contain rounded-sm shadow-2xl transition-transform duration-300" />
        
        <button id="btn-next" class="absolute right-2 md:right-8 top-1/2 -translate-y-1/2 z-20 p-3 rounded-full bg-white/10 hover:bg-white/20 text-white transition backdrop-blur-sm">
            <svg class="w-6 h-6 md:w-8 md:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>

        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/80 to-transparent pt-8 pb-4 px-4 z-20 flex flex-col items-center">
            
            <p id="lightbox-caption" class="text-white text-sm md:text-lg font-bold mb-4 tracking-wide"></p>
            
            <div class="flex gap-2 overflow-x-auto max-w-full pb-2 scrollbar-hide snap-x" id="thumbnails-container">
                </div>
        </div>

    </div>

</MainLayout>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .thumbnail {
        opacity: 0.5;
        transition: all 0.3s;
        border: 2px solid transparent;
    }
    .thumbnail.active {
        opacity: 1;
        border-color: white;
        transform: scale(1.1);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // ELEMENTY DOM
        const filterBtns = document.querySelectorAll('.filter-btn');
        const allPortfolioItems = document.querySelectorAll('.portfolio-item');
        
        const lightbox = document.getElementById('lightbox');
        const mainImg = document.getElementById('lightbox-img');
        const caption = document.getElementById('lightbox-caption');
        const counter = document.getElementById('lightbox-counter');
        const thumbnailsContainer = document.getElementById('thumbnails-container');
        
        // ZMIENNE STANU
        const allImages = Array.from(document.querySelectorAll('.gallery-img'));
        let currentImages = [...allImages]; 
        let currentIndex = 0;

        // --- 1. FUNKCJA FILTROWANIA ---
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // UI Przycisków
                filterBtns.forEach(b => {
                    b.classList.remove('bg-black', 'text-white');
                    b.classList.add('bg-white', 'text-gray-500', 'border-gray-200');
                });
                btn.classList.remove('bg-white', 'text-gray-500', 'border-gray-200');
                btn.classList.add('bg-black', 'text-white');

                const filterValue = btn.getAttribute('data-filter');
                
                // Resetujemy listę aktualnych zdjęć
                currentImages = [];

                allPortfolioItems.forEach(item => {
                    const img = item.querySelector('img');
                    
                    // Sprawdzamy czy element pasuje do filtra
                    if (filterValue === 'all' || item.classList.contains(`item-${filterValue}`)) {
                        item.classList.remove('hidden');
                        item.classList.add('block');
                        if(img) currentImages.push(img);
                    } else {
                        item.classList.add('hidden');
                        item.classList.remove('block');
                    }
                });
            });
        });


        // --- 2. FUNKCJE LIGHTBOXA ---

        const updateLightboxContent = () => {
            const currentImgElement = currentImages[currentIndex];
            const fullSrc = currentImgElement.getAttribute('data-full') || currentImgElement.src;
            
            mainImg.src = fullSrc;
            if(caption) caption.innerText = currentImgElement.alt;
            if(counter) counter.innerText = `${currentIndex + 1} / ${currentImages.length}`;

            highlightThumbnail();
        };

        const renderThumbnails = () => {
            if(!thumbnailsContainer) return;
            thumbnailsContainer.innerHTML = '';

            currentImages.forEach((img, index) => {
                const thumb = document.createElement('img');
                thumb.src = img.src; 
                thumb.className = `thumbnail h-12 w-12 md:h-16 md:w-16 object-cover rounded cursor-pointer shrink-0 snap-center border-2 border-transparent transition-all opacity-50`;
                
                thumb.addEventListener('click', (e) => {
                    e.stopPropagation();
                    currentIndex = index;
                    updateLightboxContent();
                });
                
                thumbnailsContainer.appendChild(thumb);
            });
        };

        const highlightThumbnail = () => {
            if(!thumbnailsContainer) return;
            const thumbs = Array.from(thumbnailsContainer.children);
            
            thumbs.forEach((t, i) => {
                if (i === currentIndex) {
                    t.classList.remove('opacity-50', 'border-transparent');
                    t.classList.add('opacity-100', 'border-white', 'scale-110');
                    t.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                } else {
                    t.classList.add('opacity-50', 'border-transparent');
                    t.classList.remove('opacity-100', 'border-white', 'scale-110');
                }
            });
        };

        const openLightbox = (imgElement) => {
            const index = currentImages.indexOf(imgElement);
            
            if (index > -1) {
                currentIndex = index;
                renderThumbnails();
                updateLightboxContent();
                
                lightbox.classList.remove('hidden');
                setTimeout(() => lightbox.classList.remove('opacity-0'), 10);
                // document.body.style.overflow = 'hidden'; // Usunięte żeby nie skakało
            }
        };

        const closeLightbox = () => {
            lightbox.classList.add('opacity-0');
            setTimeout(() => {
                lightbox.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        };

        // --- 3. EVENT LISTENERS ---

        allImages.forEach(img => {
            img.parentElement.addEventListener('click', (e) => {
                if (currentImages.includes(img)) {
                    openLightbox(img);
                }
            });
        });

        const showNext = (e) => { e?.stopPropagation(); currentIndex = (currentIndex + 1) % currentImages.length; updateLightboxContent(); };
        const showPrev = (e) => { e?.stopPropagation(); currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; updateLightboxContent(); };

        document.getElementById('btn-next')?.addEventListener('click', showNext);
        document.getElementById('btn-prev')?.addEventListener('click', showPrev);
        document.getElementById('lightbox-close')?.addEventListener('click', closeLightbox);

        lightbox?.addEventListener('click', (e) => {
            if (e.target === lightbox || e.target === document.querySelector('#lightbox > div')) closeLightbox();
        });

        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('hidden')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowRight') showNext();
            if (e.key === 'ArrowLeft') showPrev();
        });

    });
</script>